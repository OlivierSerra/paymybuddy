<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security"
      lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Liste des utilisateurs</title>
  <link rel="stylesheet" th:href="@{/style.css}">
</head>
<body>

<header style="display:flex; gap:1rem; align-items:center; margin-bottom:1rem;">
  <div>
    Connecté en tant que <strong><span sec:authentication="name">utilisateur</span></strong>
  </div>
  <form th:action="@{/logout}" method="post" style="margin:0;">
    <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
    <button type="submit">Se déconnecter</button>
  </form>
</header>

<h1>Liste des utilisateurs</h1>


<table>
  <thead>
    <tr>
      <th>ID</th>
      <th>Username</th>
      <th>Email</th>
      <th>Rôle</th>
      <th>Solde</th>
      <th>BankAccount</th>
      <th>Actions</th>
    </tr>
  </thead>
  <tbody>
    <tr th:each="u : ${users}">
      <td th:text="${u.id}">1</td>
      <td th:text="${u.username}">alice</td>
      <td th:text="${u.email}">alice@mail.com</td>
      <td th:text="${u.role}">USER</td>
      <td th:text="${u.balance}">100.00</td>
      <td th:text="${u.bankAccount}">789456123</td>
      <td>
        <!-- Lien visible uniquement pour les ADMIN -->
        <a sec:authorize="hasRole('ADMIN')"
           th:href="@{'/buddies'(owner=${u.username})}">
          Buddies de <span th:text="${u.username}">user</span>
        </a>
      </td>
    </tr>
  </tbody>
</table>

<hr>


<p sec:authorize="isAuthenticated()"><a th:href="@{/buddies}">Mes buddies</a></p>
<p sec:authorize="isAuthenticated()"><a th:href="@{/transactions/new}">Nouveau virement</a></p>
<p><a th:href="@{/}">Accueil</a></p>

</body>
</html>
